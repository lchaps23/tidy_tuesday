---
title: "winter_olympics"
format: html
theme: cosmo
toc: true
toc-depth: 3
number-sections: true
number-depth: 3
embed-resources: true
---

```{r}
#| label: setup
#| include: false

library(tidyverse)
library(tidytuesdayR)
library(DT)
library(lubridate)
library(janitor)
library(forcats)
library(ggridges)
```

# Getting the data
```{r}
#| label: get_data_function

get_data <- function(date, dataset_name){
  
  df <- tidytuesdayR::tt_load(date)
  
  df[[dataset_name]]

}
```

```{r}
#| label: getting_data
#| message: false

winter_olympics_26 <- get_data("2026-02-10", "schedule")
```

# Which sport disciplines have the most competitive events scheduled?

```{r}
#| label: events_scheduled

winter_olympics_26 |> 
  
  filter(is_training == "FALSE") |> 
  
  group_by(discipline_name) |> 
  
  summarise(
    events = n(),
    medal_events = sum(is_medal_event),
    medal_event_pct = round((medal_events / events) * 100, 1),
    .groups = "drop"
  ) |> 
  
  arrange(desc(events)) |> 
  
  datatable(
    
    colnames = c("Discipline Name"        = 2,
                 "Events Scheduled"       = 3,
                 "Medal Events Scheduled" = 4,
                 "Medal Events %"         = 5)
  )
```

# How are medal events distributed across the days of the Olympics?

## Medal Events

```{r}
#| label: medal_events

medal_events <- winter_olympics_26 |> 
  
  filter(is_medal_event == "TRUE") |> 
  
  select(
    date,
    discipline_code,
    discipline_name,
    event_description
  )

medal_events |> 
  
  datatable(
    
    colnames = c("Medal Event Date"  = 2,
                 "Discipline Code"   = 3,
                 "Discipline Name"   = 4,
                 "Event Description" = 5)
  )
```

## Medal Events per Day

```{r}
#| label: medal_events_per_day

medal_events_days <- medal_events |> 
  
  count(date, discipline_code, discipline_name, name = "n")


medal_events_days |> 
  
  group_by(date) |> 
  
  summarise(medal_events = sum(n)) |> 
  
  rename("Date" = date,
         "Medal Events" = medal_events)
```

## Visualising Medal Events Distribution

```{r}
#| label: medal_events_per_day_plot
#| fig-width: 8
#| fig-height: 6

# Ordering disciplines by their earliest medal event
discipline_order <- medal_events_days |> 
  
  group_by(discipline_code) |> 
  
  summarise(earliest_date = min(date)) |> 
  
  arrange(earliest_date) |> 
  
  pull(discipline_code)

# Creating the tile plot
medal_events_days |> 
  
  mutate(discipline_code = factor(discipline_code, levels = rev(discipline_order))) |>
  
  ggplot(aes(x = date, y = discipline_code, fill = n)) +
  
  geom_tile(colour = "white",
            linewidth = 0.2) +
  
  geom_text(aes(label = n),
            color = "white") +
  
  scale_fill_viridis_c(name = "Medal Events") +
  
  scale_x_date(
        breaks = seq(min(medal_events_days$date),
                 max(medal_events_days$date),
                 by = "1 day"),
        
        date_labels = "%d %b") +
  
  labs(
    title = "Distribution of Olympic Medal Events",
    subtitle = "Milano-Cortina 2026 Winter Olympics",
    x     = "Date",
    y     = "Discipline",
    caption = "Data: Milano-Cortina 2026"
  ) +
  
  theme_minimal(base_size = 13) +
  
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0),
    plot.subtitle = element_text(color = "grey40", size = 12, hjust = 0, margin = margin(b = 10)),
    plot.caption = element_text(color = "grey50", size = 9, hjust = 1),
    
    axis.text.y = element_text(vjust = 0.5, size = 11),
    axis.text.x = element_text(size = 10, angle = 90, vjust = 0.2),
    axis.title.x = element_text(margin = margin(t = 10), size = 12),
    
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_line(color = "grey90", linewidth = 0.3),
    
    legend.position = "right",
    legend.title = element_text(size = 11, face = "bold"),
    legend.text = element_text(size = 9),
    
    plot.margin = margin(20, 20, 20, 20),
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA)
  )
```

# What is the typical duration of different types of events?

## Event Durations

```{r}
#| label: creating_duration_variable

event_durations <- winter_olympics_26 |> 
  
  mutate(duration = as.numeric(difftime(end_time, start_time, units = "mins"))) |> 
  
  select(date, discipline_code, discipline_name, event_description, venue_code, venue_name, duration)
```

### Longest Duration Events

```{r}
#| label: longest_duration

event_durations |> 
  
  arrange(desc(duration)) |> 
  
  head(20)
```

### Shortest Duration Events

```{r}
#| label: shortest_duration

event_durations |> 
  
  arrange(duration) |> 
  
  head(20)
```

## Event Durations by Discipline

```{r}
#| label: event_duration_discipline_plot
#| fig-width: 8
#| fig-height: 6

# Ordering disciplines by their median duration
event_durations |> 

  mutate(discipline_code = fct_reorder(discipline_code, duration, .fun = median, .desc = FALSE)) |> 

# Creating the ridgeline plot
  ggplot(aes(x = duration, y = discipline_code, fill = after_stat(x))) +
  
  geom_density_ridges_gradient(
    scale = 3,
    rel_min_height = 0.01,
    gradient_lwd = 1,
    alpha = 0.8
  ) +
  
  scale_fill_viridis_c(
    name = "Duration (mins)",
    option = "plasma"
  ) +
  
  labs(
    title = "Distribution of Event Durations Across Olympic Disciplines",
    subtitle = "Milano-Cortina 2026 Winter Olympics",
    x = "Duration (minutes)",
    y = NULL,
    caption = "Data: Milano-Cortina 2026"
  ) +
  
  theme_minimal(base_size = 13) +
  
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0),
    plot.subtitle = element_text(color = "grey40", size = 12, hjust = 0, margin = margin(b = 10)),
    plot.caption = element_text(color = "grey50", size = 9, hjust = 1),
    
    axis.text.y = element_text(vjust = 0, size = 11),
    axis.text.x = element_text(size = 10),
    axis.title.x = element_text(margin = margin(t = 10), size = 12),
    
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_line(color = "grey90", linewidth = 0.3),
    
    legend.position = "right",
    legend.title = element_text(size = 11, face = "bold"),
    legend.text = element_text(size = 9),
    
    plot.margin = margin(20, 20, 20, 20),
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA)
  )
```

# Which venues host the most events?

## Number of Events per Venue

```{r}
#| label: venue_events

winter_olympics_26 |> 
  
  filter(!is.na(venue_code)) |> 
  
  group_by(venue_code, venue_name) |> 
  
  count(venue_code, venue_name) |> 
  
  datatable(
    colnames = c("Venue Code" = 2,
                 "Venue" = 3,
                 "Events" = 4)
  )
```

## Visualising the Number of Events per Venue

```{r}
#| label: venue_events_plot
#| fig-width: 8
#| fig-height: 6

winter_olympics_26 |> 
  
  filter(!is.na(venue_code)) |> 
  
  count(venue_code, venue_name) |> 
  
  mutate(venue_code = fct_reorder(venue_code, n)) |> 
    
  ggplot(aes(x = n, y = venue_code)) +
    
  geom_col(fill = "magenta4", alpha = 0.8) +
  
  geom_text(aes(label = n),
            color = "white",
            hjust = 1.4,
            size = 4) +
    
  labs(
    title = "Distribution of Events Across Olympic Venues",
    subtitle = "Milano-Cortina Winter Olympics 2026",
    x = "Number of Events",
    y = "Venue",
    caption = "Data: Milano-Cortina 2026"
  ) +
    
  theme_minimal(base_size = 13) +
  
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0),
    plot.subtitle = element_text(color = "grey40", size = 12, hjust = 0, margin = margin(b = 10)),
    plot.caption = element_text(color = "grey50", size = 9, hjust = 1),
    
    axis.text.y = element_text(vjust = 0.5, size = 11),
    axis.text.x = element_text(size = 10),
    axis.title.x = element_text(margin = margin(t = 10), size = 12),
    
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_line(color = "grey90", linewidth = 0.3),
    
    legend.position = "right",
    legend.title = element_text(size = 11, face = "bold"),
    legend.text = element_text(size = 9),
    
    plot.margin = margin(20, 20, 20, 20),
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA)
  )
```

