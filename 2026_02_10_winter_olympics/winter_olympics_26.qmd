---
title: "Milano-Cortina 2026 Winter Olympics"
format: html
theme: cosmo
toc: true
toc-depth: 3
number-sections: true
number-depth: 3
embed-resources: true
dpi: 900
---

```{r}
#| label: setup
#| include: false

library(tidyverse)
library(tidytuesdayR)
library(DT)
library(lubridate)
library(janitor)
library(forcats)
library(ggridges)
library(NatParksPalettes)

options(DT.options = list(pageLength = 10))
```

# Getting the data
```{r}
#| label: get_data_function

get_data <- function(date, dataset_name){
  
  df <- tidytuesdayR::tt_load(date)
  
  df[[dataset_name]]

}
```

```{r}
#| label: getting_data
#| message: false

winter_olympics_26 <- get_data("2026-02-10", "schedule")
```

# Which sport disciplines have the most competitive events scheduled?

```{r}
#| label: events_scheduled

winter_olympics_26 |> 
  
  filter(is_training == "FALSE") |> 
  
  group_by(discipline_name) |> 
  
  summarise(
    events = n(),
    medal_events = sum(is_medal_event),
    medal_events_pct = round((medal_events / events), 2),
    .groups = "drop"
  ) |> 
  
  rename(
    "Discipline" = "discipline_name",
    "Events" = "events",
    "Medal Events" = "medal_events",
    "Medal Events %" = "medal_events_pct"
  ) |> 
  
  arrange(desc(Events)) |> 
  
  datatable(
    
    options = list(
      autowidth = TRUE,
      orderClasses = TRUE
    )
  ) |>
  
  formatPercentage("Medal Events %", 0)
```

# How are medal events distributed across the days of the Olympics?

## Medal Events

```{r}
#| label: medal_events

medal_events <- winter_olympics_26 |> 
  
  filter(is_medal_event == "TRUE") |> 
  
  select(
    date,
    discipline_code,
    discipline_name,
    event_description
  )
```

## Medal Events per Day

```{r}
#| label: medal_events_per_day

medal_events_days <- medal_events |> 
  
  count(date, discipline_code, discipline_name, name = "n")


medal_events_days |> 
  
  group_by(date) |> 
  
  summarise(medal_events = sum(n)) |> 
  
  rename(
    "Date" = date,
    "Medal Events" = medal_events
  ) |> 
  
  datatable(
    options = list(
      autowidth = TRUE,
      orderClasses = TRUE
    )
  )
```

## Visualising Medal Events Distribution

```{r}
#| label: medal_events_per_day_plot
#| fig-width: 8
#| fig-height: 6

# Ordering disciplines by their earliest medal event
discipline_order <- medal_events_days |> 
  
  group_by(discipline_code) |> 
  
  summarise(earliest_date = min(date)) |> 
  
  arrange(earliest_date) |> 
  
  pull(discipline_code)

# Creating the tile plot
medal_events_days |> 
  
  mutate(discipline_code = factor(discipline_code, levels = rev(discipline_order))) |>
  
  ggplot(aes(x = date, y = discipline_code, fill = n)) +
  
  geom_tile(colour = "white",
            linewidth = 0.2) +
  
  geom_text(aes(label = n),
            color = "white") +
  
  scale_fill_viridis_c(name = "Medal Events") +
  
  scale_x_date(
        breaks = seq(min(medal_events_days$date),
                 max(medal_events_days$date),
                 by = "1 day"),
        
        date_labels = "%d %b") +
  
  labs(
    title = "Distribution of Olympic Medal Events",
    subtitle = "Milano-Cortina 2026 Winter Olympics",
    x     = "Date",
    y     = "Discipline",
    caption = "Data: Milano-Cortina 2026"
  ) +
  
  theme_minimal(base_size = 13) +
  
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0),
    plot.subtitle = element_text(color = "grey40", size = 12, hjust = 0, margin = margin(b = 10)),
    plot.caption = element_text(color = "grey50", size = 9, hjust = 1),
    
    axis.text.y = element_text(vjust = 0.5, size = 11),
    axis.text.x = element_text(size = 10, angle = 90, vjust = 0.2),
    axis.title.x = element_text(margin = margin(t = 10), size = 12),
    
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_line(color = "grey90", linewidth = 0.3),
    
    legend.position = "right",
    legend.title = element_text(size = 11, face = "bold"),
    legend.text = element_text(size = 9),
    
    plot.margin = margin(20, 20, 20, 20),
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA)
  )
```

# What is the typical duration of different types of events?

## Event Durations

```{r}
#| label: creating_duration_variable

event_durations <- winter_olympics_26 |> 
  
  mutate(duration = as.numeric(difftime(end_time, start_time, units = "mins"))) |> 
  
  select(date, discipline_code, event_description, venue_code, duration)
```

### Longest Duration Events

```{r}
#| label: longest_duration

event_durations |> 
  
  arrange(desc(duration)) |> 
  
  rename(
    "Date" = "date",
    "Discipline" = "discipline_code",
    "Event" = "event_description",
    "Venue" = "venue_code",
    "Minutes" = "duration"
  ) |> 
  
  head(20) |> 
  
    datatable(
    options = list(
      autowidth = TRUE,
      orderClasses = TRUE
    )
  )
```

### Shortest Duration Events

```{r}
#| label: shortest_duration

event_durations |> 
  
  arrange(duration) |> 
  
  rename(
    "Date" = "date",
    "Discipline" = "discipline_code",
    "Event" = "event_description",
    "Venue" = "venue_code",
    "Minutes" = "duration"
  ) |>   
  
  head(20) |> 
  
    datatable(
    options = list(
      autowidth = TRUE,
      orderClasses = TRUE
    )
  )
```

## Event Durations by Discipline

```{r}
#| label: event_duration_discipline_plot
#| fig-width: 8
#| fig-height: 6

# Ordering disciplines by their median duration
event_durations |> 

  mutate(discipline_code = fct_reorder(discipline_code, duration, .fun = median, .desc = FALSE)) |> 

# Creating the ridgeline plot
  ggplot(aes(x = duration, y = discipline_code, fill = after_stat(x))) +
  
  geom_density_ridges_gradient(
    scale = 3,
    rel_min_height = 0.01,
    gradient_lwd = 1,
    alpha = 0.8
  ) +
  
  scale_fill_gradientn(colors = natparks.pals("Glacier")) +
  
  labs(
    title = "Distribution of Event Durations Across Olympic Disciplines",
    subtitle = "Milano-Cortina 2026 Winter Olympics",
    x = "Duration (minutes)",
    y = NULL,
    caption = "Data: Milano-Cortina 2026"
  ) +
  
  theme_minimal(base_size = 13) +
  
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0),
    plot.subtitle = element_text(color = "grey40", size = 12, hjust = 0, margin = margin(b = 10)),
    plot.caption = element_text(color = "grey50", size = 9, hjust = 1),
    
    axis.text.y = element_text(vjust = 0, size = 11),
    axis.text.x = element_text(size = 10),
    axis.title.x = element_text(margin = margin(t = 10), size = 12),
    
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_line(color = "grey90", linewidth = 0.3),
    
    legend.position = "right",
    legend.title = element_text(size = 11, face = "bold"),
    legend.text = element_text(size = 9),
    
    plot.margin = margin(20, 20, 20, 20),
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA)
  )
```

# Which venues host the most events?

## Number of Events per Venue

```{r}
#| label: venue_events

winter_olympics_26 |> 
  
  filter(!is.na(venue_code)) |> 
  
  group_by(venue_code, venue_name) |> 
  
  count(venue_code, venue_name) |> 
  
  rename(
    "Venue Code" = "venue_code",
    "Venue" = "venue_name",
    "Events" = "n"
  ) |> 
  
  datatable(
    options = list(
      autowidth = TRUE,
      orderClasses = TRUE
    )
  )
```

## Visualising the Number of Events per Venue

```{r}
#| label: venue_events_plot
#| fig-width: 8
#| fig-height: 6

winter_olympics_26 |> 
  
  filter(!is.na(venue_code)) |> 
  
  count(venue_code, venue_name) |> 
  
  mutate(venue_code = fct_reorder(venue_code, n)) |> 
    
  ggplot(aes(x = n, y = venue_code)) +
    
  geom_col(fill = "royalblue4") +
  
  geom_text(aes(label = n),
            hjust = 1.2,
            size = 4,
            color = "white") +
    
  labs(
    title = "Distribution of Events Across Olympic Venues",
    subtitle = "Milano-Cortina Winter Olympics 2026",
    x = "Number of Events",
    y = "Venue",
    caption = "Data: Milano-Cortina 2026"
  ) +
    
  theme_minimal(base_size = 13) +
  
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0),
    plot.subtitle = element_text(color = "grey40", size = 12, hjust = 0, margin = margin(b = 10)),
    plot.caption = element_text(color = "grey50", size = 9, hjust = 1),
    
    axis.text.y = element_text(vjust = 0.5, size = 11),
    axis.text.x = element_text(size = 10),
    axis.title.x = element_text(size = 12),
    
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_line(color = "grey90", linewidth = 0.3),
    
    legend.position = "right",
    legend.title = element_text(size = 11, face = "bold"),
    legend.text = element_text(size = 9),
    
    plot.margin = margin(20, 20, 20, 20),
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA)
  )
```

# How does the schedule vary by day of the week?

## Events per Day

```{r}
#| label: events_per_day

day_events <- winter_olympics_26 |> 
  
  mutate(day = wday(date, label = TRUE, abbr = TRUE)) |> 
  
  group_by(day) |> 
  
  summarise(
    events = n(),
    medal_events = sum(is_medal_event[TRUE]),
    medal_pct = round((medal_events / events), 2),
    training_events = sum(is_training[TRUE]),
    training_pct = round((training_events / events), 2),
    .groups = "drop"
  )

day_events |> 
  
  rename(
    "Day" = "day",
    "Events" = "events",
    "Medal Events" = "medal_events",
    "Medal %" = "medal_pct",
    "Training Events" = "training_events",
    "Training %" = "training_pct"
  ) |> 
  
  datatable(
    options = list(
      autowidth = TRUE,
      orderClasses = TRUE      
    )
  ) |> 
  
  formatPercentage(c("Medal %", "Training %"), 0)
```

```{r}
#| label: events_per_day_plot
#| fig-height: 6
#| fig-width: 8

day_events |> 
  
  ggplot(aes(x = day, y = events)) +
  
  geom_col(fill = "royalblue4") +
  
  geom_text(aes(label = events),
            vjust = 2,
            size = 4,
            color = "white") +
    
  labs(
    title = "Total Olympic Event Volume by Day",
    subtitle = "Milano-Cortina Winter Olympics 2026",
    x = NULL,
    y = "Total Events",
    caption = "Data: Milano-Cortina 2026"
  ) +
    
  theme_minimal(base_size = 13) +
  
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0),
    plot.subtitle = element_text(color = "grey40", size = 12, hjust = 0, margin = margin(b = 10)),
    plot.caption = element_text(color = "grey50", size = 9, hjust = 1),
    
    axis.text.y = element_text(vjust = 0.5, size = 11),
    axis.text.x = element_text(size = 10),
    axis.title.x = element_text(size = 12),
    
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_line(color = "grey90", linewidth = 0.3),
    
    legend.position = "right",
    legend.title = element_text(size = 11, face = "bold"),
    legend.text = element_text(size = 9),
    
    plot.margin = margin(20, 20, 20, 20),
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA)
  )
```

## The Nature of the Daily Schedule

```{r}
#| label: event_types_per_day_plot
#| fig-height: 6
#| fig-width: 8

day_events |> 
  
  pivot_longer(cols = c(medal_events, training_events),
               names_to = "event_type",
               values_to = "count"
  ) |> 
  
  ggplot(aes(x = day, y = count, fill = event_type)) +
  
  geom_col(position = "dodge") +
  
  geom_line() +
  
  geom_text(aes(label = count),
            position = position_dodge(width = 0.9),
            vjust = 2,
            size = 4
            ) +
  
  scale_fill_manual(
    values = c("medal_events" = "gold2",
               "training_events" = "grey70"),
    labels = c("Medal Events", "Training Events"),
    name = "Event Type"
  ) +
  
  labs(
    title = "Medal Events vs Training Events Across the Week",
    subtitle = "Milano-Cortina Winter Olympics 2026",
    x = NULL,
    y = "Number of Events",
    caption = "Data: Milano-Cortina 2026"
  ) +
  
  theme_minimal(base_size = 13) +
  
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0),
    plot.subtitle = element_text(color = "grey40", size = 12, hjust = 0, margin = margin(b = 10)),
    plot.caption = element_text(color = "grey50", size = 9, hjust = 1),
    
    axis.text.y = element_text(vjust = 0.5, size = 11),
    axis.text.x = element_text(size = 10),
    axis.title.x = element_text(size = 12),
    
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_line(color = "grey90", linewidth = 0.3),
    
    legend.position = "right",
    legend.title = element_text(size = 11, face = "bold"),
    legend.text = element_text(size = 9),
    
    plot.margin = margin(20, 20, 20, 20),
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA)
  )
```

## The Intensity Slope

```{r}
#| label: intensity_slope_plot
#| fig-height: 6
#| fig-width: 8

day_events |> 
  
  ggplot(aes(x = day, group = 1)) +
  
  geom_line(aes(y = medal_pct, color = "Medal %"), 
            linewidth = 1.2) +
  
  geom_line(aes(y = training_pct, color = "Training %"),
            linewidth = 1.2) +
  
  geom_point(aes(y = medal_pct, color = "Medal %"),
             size = 3) +
  
  geom_point(aes(y = training_pct, color = "Training %"),
             size = 3) +
  
  scale_color_manual(values = c("Medal %" = "gold2", 
                                "Training %" = "grey70"),
                     name = "Event Type %") +
  
  labs(
    title = "The Intensity Slope",
    subtitle = "Milano-Cortina Winter Olympics 2026",
    x = NULL,
    y = "% of Events",
    caption = "Data: Milano-Cortina 2026"
  ) +
  
  theme_minimal(base_size = 13) +
  
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0),
    plot.subtitle = element_text(color = "grey40", size = 12, hjust = 0, margin = margin(b = 10)),
    plot.caption = element_text(color = "grey50", size = 9, hjust = 1),
    
    axis.text.y = element_text(vjust = 0.5, size = 11),
    axis.text.x = element_text(size = 10),
    axis.title.x = element_text(size = 12),
    
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_line(color = "grey90", linewidth = 0.3),
    
    legend.position = "right",
    legend.title = element_text(size = 11, face = "bold"),
    legend.text = element_text(size = 9),
    
    plot.margin = margin(20, 20, 20, 20),
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA)
  )
```

# What proportion of scheduled sessions are training versus competition?

```{r}


winter_olympics_26 |> 
  
  count(is_training) |>  

  mutate(
    is_training = recode_values(
      is_training, 
      TRUE ~ "Training", 
      FALSE ~ "Competitive"
      ),
    prop = round(n / sum(n), 2)
  ) |> 
  
  rename(
    "Event Type" = "is_training",
    "Total Events" = "n",
    "Type %" = "prop"
  ) |> 
  
  datatable(
    options = list(
      autowidth = TRUE,
      orderClasses = TRUE 
    )
  ) |> 
  
  formatPercentage("Type %", 0)
```



